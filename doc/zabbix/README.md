# Zabbix 7.0 設定マニュアル

## 目次:
1. サーバ自動追加設定
2. Web監視
3. ODBC監視（DB監視）
4. ディスク監視
5. ログ監視
6. Slack通知

## 1. サーバ自動追加設定

### 前提条件:
- Zabbix 7.0がインストールされていること
- 自動検出ルールを設定するための権限があること

### 手順:

#### 1. アクションの設定(既存ルール有効化)
a. 通知 > アクション > ディスカバリアクション に移動します。
b. 「Auto discovery. Linux servers.」を「無効」をクリックし、「有効」します。

#### 2. 自動検出ルールの作成(既存ルール有効化)
1. データ収集 > ディスカバリ に移動します。
2. ディスカバリルールから「Local network」を無効をクリックし、「有効」とします。

## 2. Web監視

### 前提条件:
- ローカルネットワークから監視対象のWebサイトにアクセスできること

### 手順:

#### 1. Web シナリオの作成
a. データ収集 > ホスト に移動します。
b. 対象のホスト(192.168.0.10)の「Web」リンクをクリックします。
c. 「Web シナリオの作成」をクリックします。
d. 以下の設定を行います：
   - 名前: わかりやすい名前を付けます(例：Web監視(192.168.0.10))
   - 監視間隔: チェックの頻度を設定します(例：1m)
   - 試行回数：1
   - エージェント: Zabbix
e. 「ステップの追加」をクリックします。
f. 以下の設定を行います：
   - 名前: わかりやすい名前を付けます(例：Web監視(192.168.0.10))
   - URL: http://192.168.0.10:81 (※水平スケールした場合は異なるIPを設定すること)
   - 要求ステータスコード：200
   - エージェント: Zabbix
g. 「追加」をクリックして保存します。

## 3. ODBC監視（DB監視）

### 1. 前提条件
- 監視対象のデータベースサーバーが稼働していること
- ODBCドライバーがインストールされていること

### 2. アイテムの作成
a. ホストの画面を開く
b. データ収集 > ホスト > アイテムを選択する
c. 「アイテムの作成」 をクリックする
c. 以下の設定を行う:
   - 名前: わかりやすい名前を付ける（Ex. Postgresql host）
   - タイプ: データベースモニタ
   - キー: `db.odbc.select[DB_ALIVE_TEST,TEST_PSQL]`と入れてください
   - データ型: 数値
   - ユーザー名: データベースへの接続ユーザー
   - パスワード: データベースへの接続パスワード
   - SQLクエリ: 実行したいSQLクエリを入力（`SELECT 1;`）
   - 監視間隔：`1m`
d. [追加] をクリックして保存

### 3. テストと確認
a. 作成したアイテムの [テスト] ボタンをクリックする
b. テスト結果を確認し、正しく値が取得できることを確認する（`1`という値くること）

### 4. トリガーの設定（オプション）
a. データ収集 > ホスト > トリガーを選択する
b. `トリガーの作成` をクリックする
c. 新規トリガーでは以下を入力する
	1. アイテム 「アイテムの作成にて追加したデータ」
	2. 関数：`last()`
	3. 結果： `<>` `1`
d. [追加] をクリックして保存

### 5. グラフの作成（オプション）
a. データ収集 > ホスト > グラフを選択する
b. 「グラフの作成」 をクリックする
c. 作成したアイテムを選択し、グラフの設定を行う
d. [追加] をクリックして保存

# TBD -- スタート
### 7. ダッシュボードへの追加（オプション）
a. [監視データ] > [ダッシュボード] に移動する
b. 新しいダッシュボードを作成するか、既存のものを編集する
c. グラフやトリガー情報をダッシュボードに追加する

### 8. 監視の開始
- 設定した間隔でZabbixがODBCを使用してデータベースから情報を収集し始めます
- ダッシュボード、グラフ、トリガーなどを通じて監視結果を確認します


### 注意事項:
- セキュリティを考慮し、データベース接続には最小限の権限を持つユーザーを使用してください
- 複雑または重いSQLクエリは、データベースのパフォーマンスに影響を与える可能性があるため注意してください
- 定期的にODBC監視の設定とパフォーマンスを見直し、必要に応じて調整してください

## 4. ディスク監視

### 前提条件:
- Zabbix 7.0がインストールされていること
- 監視対象のサーバにZabbix Agentがインストールされていること

### 手順:

#### 1. アイテムの作成
a. 設定 > ホスト に移動し、対象のホストを選択します。
b. アイテム タブをクリックし、「アイテムの作成」をクリックします。
c. 以下の設定を行います：
   - 名前: わかりやすい名前を付けます（例：ディスク使用率）
   - タイプ: Zabbix agent
   - キー: vfs.fs.size[/,pused] (ルートパーティションの使用率の例)
   - 単位: %
d. 「追加」をクリックして保存します。

## 5. ログ監視

### 前提条件:
- Zabbix 7.0がインストールされていること
- 監視対象のサーバにZabbix Agentがインストールされていること

### 手順:

#### 1. アイテムの作成
a. 設定 > ホスト に移動し、対象のホストを選択します。
b. アイテム タブをクリックし、「アイテムの作成」をクリックします。
c. 以下の設定を行います：
   - 名前: わかりやすい名前を付けます
   - タイプ: Zabbix agent (active)
   - キー: log[/var/log/syslog] (監視対象のログファイルパスを指定)
d. 「追加」をクリックして保存します。

#### 2. トリガーの設定
a. トリガー タブをクリックし、「トリガーの作成」をクリックします。
b. 以下の設定を行います：
   - 名前: わかりやすい名前を付けます
   - 式: {ホスト名:log[/var/log/syslog].str(エラー)}=1
c. 「追加」をクリックして保存します。

## 6. Slack通知

### 前提条件:
- Zabbix 7.0がインストールされていること
- Slackワークスペースとチャンネルが準備されていること

### 手順:

#### 1. Slackアプリの設定
a. Slack APIサイトで新しいアプリを作成します。
b. アプリにIncoming Webhookの権限を付与します。
c. Webhook URLを取得します。

#### 2. メディアタイプの作成
a. 管理 > メディアタイプ に移動します。
b. 「メディアタイプの作成」をクリックします。
c. 以下の設定を行います：
   - 名前: Slack
   - タイプ: Webhook
   - パラメータ: URL (Slackから取得したWebhook URL)
d. 「追加」をクリックして保存します。

#### 3. アクションの設定
a. 設定 > アクション > トリガーアクション に移動します。
b. 「アクションの作成」をクリックします。
c. 条件とオペレーションを設定し、Slackメディアタイプを使用するように設定します。
d. 「追加」をクリックして保存します。

以上が基本的な設定方法です。各項目の詳細な設定や最適化は、環境や要件に応じて適宜調整してください。

# TBD -- エンド 